steps:
- checkout: self
  fetchDepth: 1
  submodules: false
  fetchTags: false

- task: PublishPipelineArtifact@1
  displayName: "Save build YAML"
  inputs:
    artifactName: yaml
    targetPath: "$(Build.Repository.LocalPath)\\eng\\pipelines"

- task: DotNetCoreCLI@2
  name: setbuildvariables
  displayName: Set Build Variables
  inputs:
    command: custom
    projects: build\\config.props 
    custom: msbuild
    arguments: /noautorsp /ConsoleLoggerParameters:Verbosity=Minimal;NoSummary;ForceNoAlign /nologo /target:SetHostedBuildVariables /binarylogger:LogFile=$(BINLOG_DIRECTORY)\SetHostedBuildVariables.binlog
  env:
    DOTNET_CLI_TELEMETRY_OPTOUT: true
    DOTNET_SKIP_FIRST_TIME_EXPERIENCE: true

- powershell: |
      . $(Build.Repository.LocalPath)\\scripts\\utils\\PostGitCommitStatus.ps1
      CheckVstsPersonalAccessToken -VstsPersonalAccessToken $(System.AccessToken)
  displayName: "Check VSTS Personal Access Token"

- powershell: |
      . $(Build.Repository.LocalPath)\\scripts\\utils\\PostGitCommitStatus.ps1
      InitializeAllTestsToPending -PersonalAccessToken $(NuGetLurkerPersonalAccessToken) -CommitSha $(Build.SourceVersion)
  displayName: "Initialize Git Commit Status on GitHub"
  condition: "not(eq(variables['ManualGitHubChecks'], 'false'))"
